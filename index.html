<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ãƒ¯ãƒ‹ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ </title>

<style>
body {
    margin: 0;
    background: #000;
    overflow: hidden;
    touch-action: none;
    color: #fff;
    font-family: sans-serif;
}

/* ãƒ¯ãƒ‹ï¼ˆç”»åƒï¼‰ */
#player {
    position: absolute;
    bottom: 5vh;
    left: 50%;
    transform: translateX(-50%);
    width: 160px;
    transition: 0.05s;
}

/* è½ä¸‹ç‰©ï¼ˆå¤§ãã‚ï¼‰ */
.item {
    position: absolute;
    top: -160px;
    width: 140px;
    height: 140px;
    font-size: 110px;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* UI */
#score, #timer {
    position: absolute;
    left: 10px;
    font-size: 30px;
}
#timer { top: 40px; }

#restartBtn {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 40px;
    background: #fff;
    border-radius: 10px;
    color: #000;
    font-size: 30px;
    display: none;
}
</style>
</head>

<body>

<img id="player" src="wani_normal.png">

<div id="score">Score: 0</div>
<div id="timer">Time: 30</div>

<div id="restartBtn">ã‚‚ã†ä¸€å›ï¼</div>

<script>
let score = 0;
let time = 30;
let running = true;
let playerX = window.innerWidth / 2;
const fruits = ["ğŸ","ğŸŒ","ğŸ‡","ğŸ‘","ğŸ“"];

const player = document.getElementById("player");

/* æ“ä½œï¼ˆã‚¹ãƒãƒ›&PCï¼‰ */
document.addEventListener("touchstart", e => playerX = e.touches[0].clientX);
document.addEventListener("touchmove",  e => playerX = e.touches[0].clientX);
document.addEventListener("mousemove",  e => playerX = e.clientX);

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹• */
setInterval(()=>{
    player.style.left = (playerX - player.width/2) + "px";
}, 16);

/* è½ä¸‹ç‰©ç”Ÿæˆ */
function spawnItem(){
    if (!running) return;

    const item = document.createElement("div");
    item.className = "item";

    const isBomb = Math.random() < 0.25;
    item.textContent = isBomb ? "ğŸ’£" : fruits[Math.floor(Math.random()*fruits.length)];

    item.style.left = Math.random() * (window.innerWidth - 140) + "px";
    document.body.appendChild(item);

    let y = -160;

    const fall = setInterval(()=>{
        if (!running){
            clearInterval(fall);
            item.remove();
            return;
        }

        y += 7;
        item.style.top = y + "px";

        const p = player.getBoundingClientRect();
        const b = item.getBoundingClientRect();

        // å½“ãŸã‚Šåˆ¤å®š
        if (
            b.bottom > p.top &&
            b.top < p.bottom &&
            b.right > p.left &&
            b.left < p.right
        ){
            clearInterval(fall);
            item.remove();

            // å£é–‹ã â†’ 200ms ã§é–‰ã˜ã‚‹
            player.src = "wani_open.png";
            setTimeout(()=> player.src = "wani_normal.png", 200);

            // ã‚¹ã‚³ã‚¢è¨ˆç®—
            if (isBomb) score--;
            else score++;

            document.getElementById("score").textContent = "Score: " + score;
        }

        // ç”»é¢å¤–ã§å‰Šé™¤
        if (y > window.innerHeight){
            clearInterval(fall);
            item.remove();
        }
    }, 16);
}

/* ä¸€å®šé–“éš”ã§è½ä¸‹ */
let spawnInterval = setInterval(spawnItem, 650);

/* ã‚¿ã‚¤ãƒãƒ¼ */
let timerInterval = setInterval(()=>{
    if (!running) return;

    time--;
    document.getElementById("timer").textContent = "Time: " + time;

    if (time <= 0){
        running = false;
        clearInterval(spawnInterval);
        clearInterval(timerInterval);
        document.getElementById("restartBtn").style.display = "block";
    }
}, 1000);

/* ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ */
document.getElementById("restartBtn").onclick = () => {
    location.reload();
};
</script>

</body>
</html>
