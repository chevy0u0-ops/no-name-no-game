<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Fruit Catch Game</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #f9f5e8;
        font-family: sans-serif;
    }
    #gameCanvas {
        background: #e8e1d0;
        display: block;
        margin: 0 auto;
    }
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
// ----- Canvas Setup -----
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ----- Basket -----
const basket = {
    x: canvas.width / 2 - 40,
    y: canvas.height - 80,
    width: 80,
    height: 45,
    speed: 6
};

// ----- Fruits & Bomb -----
const fruitTypes = ["ğŸ", "ğŸŒ", "ğŸ‡", "ğŸ’"];
let objects = [];
let score = 0;
let lastFruit = null; // é€£ç¶šãƒœãƒ¼ãƒŠã‚¹ç”¨

// ----- Spawn Objects -----
function spawnObject() {
    const isBomb = Math.random() < 0.25; // çˆ†å¼¾ã¯å°‘ã—å¤šã
    const size = 35; // 3åˆ†ã®2ã‚µã‚¤ã‚ºï¼ˆèª¿æ•´æ¸ˆï¼‰

    objects.push({
        x: Math.random() * (canvas.width - size),
        y: -50,
        size: size,
        speed: 2 + Math.random() * 2,
        type: isBomb ? "ğŸ’£" : fruitTypes[Math.floor(Math.random() * fruitTypes.length)]
    });
}

setInterval(spawnObject, 700);

// ----- Draw Basket -----
function drawBasket() {
    ctx.fillStyle = "#8b5a2b"; // æœ¨è£½é¢¨
    ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
}

// ----- Draw Objects -----
function drawObjects() {
    ctx.font = "30px serif";
    objects.forEach(obj => {
        ctx.fillText(obj.type, obj.x, obj.y);
    });
}

// ----- Update Objects -----
function updateObjects() {
    for (let i = 0; i < objects.length; i++) {
        let obj = objects[i];
        obj.y += obj.speed;

        // ã‚«ã‚´ã¨ã®å½“ãŸã‚Šåˆ¤å®š
        if (
            obj.y + obj.size > basket.y &&
            obj.x < basket.x + basket.width &&
            obj.x + obj.size > basket.x
        ) {
            if (obj.type === "ğŸ’£") {
                alert("ğŸ’¥ çˆ†å¼¾ã«å½“ãŸã£ãŸï¼ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼\nã‚¹ã‚³ã‚¢: " + score);
                location.reload();
                return;
            }

            // ãƒ•ãƒ«ãƒ¼ãƒ„ç²å¾—
            score += 5;

            // ãƒœãƒ¼ãƒŠã‚¹ï¼šåŒã˜ãƒ•ãƒ«ãƒ¼ãƒ„é€£ç¶š
            if (obj.type === lastFruit) {
                score += 10; // ãƒœãƒ¼ãƒŠã‚¹
            }
            lastFruit = obj.type;

            objects.splice(i, 1);
            i--;
        }

        // ç”»é¢å¤–å‡¦ç†
        if (obj.y > canvas.height) {
            objects.splice(i, 1);
            i--;
        }
    }
}

// ----- Draw Score -----
function drawScore() {
    ctx.fillStyle = "#000";
    ctx.font = "20px sans-serif";
    ctx.fillText("Score: " + score, 10, 30);
}

// ----- Game Loop -----
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawBasket();
    drawObjects();
    updateObjects();
    drawScore();

    requestAnimationFrame(gameLoop);
}

gameLoop();

// ----- Controls -----
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") basket.x -= basket.speed;
    if (e.key === "ArrowRight") basket.x += basket.speed;

    // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«
    basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
});
</script>

</body>
</html>
