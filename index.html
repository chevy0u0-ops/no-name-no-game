
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fruit Basket Catch</title>

<style>
body {
    margin: 0;
    background: #f6f2e8;
    font-family: sans-serif;
    overflow: hidden;
}

/* å…±é€š */
canvas {
    display: block;
    margin: 0 auto;
    background: #e8dfcf;
}

/* ãƒœã‚¿ãƒ³ */
.button {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 30px;
    background: #8B5A2B;
    color: #fff;
    font-size: 20px;
    border-radius: 12px;
}
</style>
</head>

<body>

<canvas id="game" width="360" height="640"></canvas>
<div id="startBtn" class="button" style="bottom: 140px;">START</div>
<div id="restartBtn" class="button" style="bottom: 140px; display:none;">RESTART</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let scene = "title"; // title, game, result
let score = 0;
let time = 30;

const fruits = ["ğŸ","ğŸŒ","ğŸ‡","ğŸ’","ğŸ‘"];
const bomb = "ğŸ’£";
let items = [];

// ã‚«ã‚´
const basket = {
    x: canvas.width / 2 - 50,
    y: canvas.height - 80,
    width: 100,
    height: 50
};

// ====================
// ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢
// ====================
function drawTitle() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ãƒ•ãƒ«ãƒ¼ãƒ„èƒŒæ™¯
    for (let i = 0; i < 40; i++) {
        ctx.font = `${20 + Math.random()*30}px serif`;
        const emoji = Math.random() < 0.2 ? bomb : fruits[Math.floor(Math.random()*fruits.length)];
        ctx.fillText(emoji, Math.random()*canvas.width, Math.random()*canvas.height);
    }

    // ã‚¿ã‚¤ãƒˆãƒ«
    ctx.fillStyle = "#5a3b1e";
    ctx.fillRect(40, 220, 280, 80);
    ctx.fillStyle = "#fff";
    ctx.font = "28px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("Fruit Basket Catch", canvas.width/2, 270);
}

// ====================
// ã‚²ãƒ¼ãƒ å‡¦ç†
// ====================
function spawnItem() {
    const isBomb = Math.random() < 0.35;
    items.push({
        emoji: isBomb ? bomb : fruits[Math.floor(Math.random()*fruits.length)],
        x: Math.random()*(canvas.width-40),
        y: -40,
        speed: 2 + Math.random()*2,
        isBomb
    });
}

function drawBasket() {
    // æœ¨è£½ã‚«ã‚´é¢¨
    ctx.fillStyle = "#8B4513";
    ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
    ctx.strokeStyle = "#5a2f0f";
    for (let i = 0; i < basket.width; i += 10) {
        ctx.beginPath();
        ctx.moveTo(basket.x + i, basket.y);
        ctx.lineTo(basket.x + i, basket.y + basket.height);
        ctx.stroke();
    }
}

function updateGame() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (Math.random() < 0.04) spawnItem();

    items.forEach((item, i) => {
        item.y += item.speed;
        ctx.font = "36px serif";
        ctx.fillText(item.emoji, item.x, item.y);

        // å½“ãŸã‚Šåˆ¤å®š
        if (
            item.y > basket.y &&
            item.x > basket.x - 20 &&
            item.x < basket.x + basket.width
        ) {
            score += item.isBomb ? -1 : 1;
            items.splice(i,1);
        }

        if (item.y > canvas.height) items.splice(i,1);
    });

    drawBasket();

    // UI
    ctx.fillStyle = "#000";
    ctx.font = "18px sans-serif";
    ctx.textAlign = "left";
    ctx.fillText("Score: " + score, 10, 25);
    ctx.textAlign = "right";
    ctx.fillText("Time: " + time, canvas.width-10, 25);
}

// ====================
// ãƒªã‚¶ãƒ«ãƒˆ
// ====================
function drawResult() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#5a3b1e";
    ctx.fillRect(40, 240, 280, 120);

    ctx.fillStyle = "#fff";
    ctx.textAlign = "center";
    ctx.font = "28px sans-serif";
    ctx.fillText("TIME UP", canvas.width/2, 290);
    ctx.font = "22px sans-serif";
    ctx.fillText("Score: " + score, canvas.width/2, 330);
}

// ====================
// æ“ä½œ
// ====================
canvas.addEventListener("touchmove", e => {
    const rect = canvas.getBoundingClientRect();
    basket.x = e.touches[0].clientX - rect.left - basket.width/2;
});

document.addEventListener("mousemove", e => {
    basket.x = e.clientX - basket.width/2;
});

// ====================
// ãƒ«ãƒ¼ãƒ—
// ====================
function loop() {
    if (scene === "title") drawTitle();
    if (scene === "game") updateGame();
    if (scene === "result") drawResult();
    requestAnimationFrame(loop);
}
loop();

// ====================
// ãƒœã‚¿ãƒ³
// ====================
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");

startBtn.onclick = () => {
    scene = "game";
    score = 0;
    time = 30;
    items = [];
    startBtn.style.display = "none";

    // ã‚¿ã‚¤ãƒãƒ¼
    const timer = setInterval(()=>{
        if (scene !== "game") return;
        time--;
        if (time <= 0) {
            scene = "result";
            restartBtn.style.display = "block";
            clearInterval(timer);

            // â˜…â˜…â˜… åºƒå‘Šã‚’å…¥ã‚Œã‚‹ãªã‚‰ã“ã“ â˜…â˜…â˜…
            // showInterstitialAd();
        }
    },1000);
};

restartBtn.onclick = () => {
    scene = "title";
    restartBtn.style.display = "none";
    startBtn.style.display = "block";
};
</script>

</body>
</html>
